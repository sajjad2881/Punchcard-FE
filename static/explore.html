<!DOCTYPE html>
<html>

<head>
  <title>Restaurant Map</title>
  <style>
    #map {
      height: 400px;
      width: 100%;
    }

    #info {
      padding: 10px;
    }
  </style>

  <script type="text/javascript" src="../lib/axios/dist/axios.standalone.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/rollups/hmac-sha256.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/rollups/sha256.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/components/hmac.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/components/enc-base64.js"></script>
  <script type="text/javascript" src="../lib/url-template/url-template.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/sigV4Client.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/apiGatewayClient.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/simpleHttpClient.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/utils.js"></script>
  <script type="text/javascript" src="../apigClient.js"></script>
</head>

<body>
  <div id="map"></div>
  <div id="info"></div>

  <script>
    // Sample data for restaurants
    /*
      {"website": "columbia.edu", 
      "custom:cuisines": "Indian, Desi, South Indian, Curry", 
      "phone_number_verified": "false", "cognito:email_alias": 
      "sanjay.rajasekharan@gmail.com", 
      "address": "605-615 W 115th St, New York, NY 10027, USA", 
      "custom:latitude": "40.80785939999999", 
      "picture": "https://business-profile-pictures.s3.amazonaws.com/profile-images/sanjay.rajasekharan@gmail.com.jpg", 
      "email": "sanjay.rajasekharan@gmail.com", 
      "name": "Sanjay's Curry House", 
      "restaurantID": "e0f9f94f-c8bb-41a5-8499-3972beaafe17", 
      "email_verified": "true", 
      "custom:descriptors": "quack, pee pee, poo poo", 
      "custom:longitude": "-73.9651746", 
      "custom:locationTags": "uws, nyc, manhattan", 
      "phone_number": "+14086219659", 
      "cognito:user_status": "CONFIRMED", 
      "custom:descriptionText": "The masters of the culinary arts.", 
      "custom:adminName": "Sanjay"}
    */

    // Sample restaurantIDs
    const restaurantIDs = ["e0f9f94f-c8bb-41a5-8499-3972beaafe17", "bd132eba-4dd7-4348-afa4-10ed3689893c", "06639a5a-61df-409b-84ab-27c26025526b"];

    // Get restaurant information from the API Gateway
    const apigClient = apigClientFactory.newClient();
    const pathTemplate = '/restaurants/{restaurantID}';
    const method = 'GET';
    const additionalParams = {};
    const body = {};
    const restaurantsPromise = Promise.all(restaurantIDs.map(restaurantID => {
      const pathParameters = { restaurantID }; // Updated parameter name
      return apigClient.restaurantsRestaurantIDGet(pathParameters, body, additionalParams);
    }));
    // Wait for all the API calls to finish
    let restaurants = [];
    restaurantsPromise.then(responses => {

      // Extract the data from each response
      restaurants = responses.map(response => response.data);

      initMap();
    });

    // Initialize the map
    function initMap() {
      const map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 40.80785939999999, lng: -73.9651746 },
        zoom: 12
      });

      // Add markers for each restaurant
      // restaurants is not iterable?
      console.log(restaurants)
      if (typeof restaurants !== "undefined") {
        for (let restaurant of restaurants) {
          console.log(restaurant["custom:latitude"], restaurant["custom:longitude"])
          const marker = new google.maps.Marker({
            position: {
              lat: parseFloat(restaurant["custom:latitude"]),
              lng: parseFloat(restaurant["custom:longitude"])
            },
            map: map,
            title: restaurant.name
          });

          // Add click listener to the marker
          marker.addListener('click', () => {
            // Display restaurant information when the marker is clicked
            document.getElementById('info').innerHTML = `
            <h3>${restaurant['name']}</h3>
            <p>${restaurant['custom:descriptionText']}</p>
            <p>${restaurant['address']}</p>
            <p>${restaurant['custom:cuisines']}</p>
          `;
          });
        }
      }
    }
  </script>

  <!-- Load the Google Maps JavaScript API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAQeyUyXmQcMr3ooXhDe9bO-Z14d2cwPg&callback=initMap"></script>
</body>

</html>