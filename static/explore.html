<!DOCTYPE html>
<html>

<head>
  <title>Restaurant Map</title>
  <style>
    #map {
      height: 400px;
      width: 100%;
    }

    #info {
      padding: 10px;
    }
  </style>

  <script type="text/javascript" src="../lib/axios/dist/axios.standalone.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/rollups/hmac-sha256.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/rollups/sha256.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/components/hmac.js"></script>
  <script type="text/javascript" src="../lib/CryptoJS/components/enc-base64.js"></script>
  <script type="text/javascript" src="../lib/url-template/url-template.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/sigV4Client.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/apiGatewayClient.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/simpleHttpClient.js"></script>
  <script type="text/javascript" src="../lib/apiGatewayCore/utils.js"></script>
  <script type="text/javascript" src="../apigClient.js"></script>
</head>

<body>
  <div id="map"></div>
  <div id="info"></div>

  <script>
    const restaurantIDs = ["e0f9f94f-c8bb-41a5-8499-3972beaafe17", "bd132eba-4dd7-4348-afa4-10ed3689893c", "06639a5a-61df-409b-84ab-27c26025526b"];
    const apigClient = apigClientFactory.newClient();
    const pathTemplate = '/restaurants/{restaurantID}';
    const method = 'GET';
    const additionalParams = {};
    const body = {};

    const restaurantsPromise = Promise.all(restaurantIDs.map(restaurantID => {
      const pathParameters = { restaurantID };
      return apigClient.restaurantsRestaurantIDGet(pathParameters, body, additionalParams);
    }));

    let restaurants = [];
    restaurantsPromise.then(responses => {
      restaurants = responses.map(response => response.data);
      initMap();
    });

    function initMap() {
      const defaultLocation = { lat: 40.80785939999999, lng: -73.9651746 };
      const map = new google.maps.Map(document.getElementById('map'), {
        center: defaultLocation,
        zoom: 12
      });

      if (typeof restaurants !== "undefined") {
        for (let restaurant of restaurants) {
          const marker = new google.maps.Marker({
            position: {
              lat: parseFloat(restaurant["custom:latitude"]),
              lng: parseFloat(restaurant["custom:longitude"])
            },
            map: map,
            title: restaurant.name
          });

          marker.addListener('click', () => {
            document.getElementById('info').innerHTML = `
            <h3>${restaurant['name']}</h3>
            <p>${restaurant['custom:descriptionText']}</p>
            <p>${restaurant['address']}</p>
            <p>${restaurant['custom:cuisines']}</p>
          `;
          });
        }
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          let scale = 500; // Initial radius of the circle
          let increment = 5; // Change in radius per interval

          // Create the circle
          let circle = new google.maps.Circle({
            strokeColor: '#FFFFFF', // White border
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#0000FF', // Blue fill
            fillOpacity: 0.35,
            map: map,
            center: { lat: userLocation.lat, lng: userLocation.lng }, // Replace with your coordinates
            radius: scale
          });

          // Animate the circle
          setInterval(() => {
            scale += increment;

            // Reverse direction if the circle gets too big or too small
            if (scale > 1000 || scale < 500) {
              increment = -increment;
            }

            // Update the radius of the circle
            circle.setRadius(scale);
          }, 100); // Change the interval as desired

          map.panTo(userLocation);
        }, () => {
          // If the user declines to share their location, use the default center
          map.panTo(defaultLocation);
        });
      } else {
        // Browser doesn't support Geolocation
        map.panTo(defaultLocation);
      }
    }
  </script>

  <!-- Load the Google Maps JavaScript API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAQeyUyXmQcMr3ooXhDe9bO-Z14d2cwPg&callback=initMap"></script>
</body>

</html>